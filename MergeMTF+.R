rm(list=ls()) #remoVe lingering Variables

library("haven")#to read dta
library("dplyr") #to manipulate dta

setwd("C:/Users/jimmy/Documents/Orben/2_datasets") # Set directory to folder with 2008-2016 data
#Each version contains different variable sets
d81 <- read_dta("25422-0001-Data.dta") 
d82 <- read_dta("25422-0002-Data.dta")
d83 <- read_dta("25422-0003-Data.dta")
#Pull variables from each version
d81 <- select(d81,V1101, V1114, V1399,V1402,V1403)
d82 <- select(d82,V1, V2360,V2359,V2368,V2370,V2366,V2394,V2238,V2122,V2121,V2119,V2282,V2102,V2369,V2362,V2371,V2395,V2361,V2358,V2365,V2364)
d83 <- select(d83, V3240, V3367, V3366,V3369,V3370,V3372,V3373,V3246,V3254,V3255,V3123,V3259,V3283)
d81[nrow(d81)+1,] <- NA # Add NA columns and combine to one dataframe
d82$V1101 <- d81$V1101
d82$V1114 <- d81$V1114
d82$V1399 <- d81$V1399
d82$V1402 <- d81$V1402
d82$V1403 <- d81$V1403
d83[nrow(d83)+2695,] <- NA # Add NA columns 
d82$V3240 <- d83$V3240
d82$V3367 <- d83$V3367
d82$V3366 <- d83$V3366
d82$V3369 <- d83$V3369
d82$V3370 <- d83$V3370
d82$V3372 <- d83$V3372
d82$V3373 <- d83$V3373
d82$V3246 <- d83$V3246
d82$V3254 <- d83$V3254
d82$V3255 <- d83$V3255
d82$V3123 <- d83$V3123
d82$V3259 <- d83$V3259
d82$V3283 <- d83$V3283
d82$V7589 <- NA
d82$V7590 <- NA
d82$V7562 <- NA
d82$V7563 <- NA

d2008 <- d82 %>%  #Change question Variable names to match with other years
  rename(
    V501 = V1101, V7202 = V3240, V8503 = V2360, V8502 = V2359, V8511 = V2368, V8513 = V2370, V7502 = V3367, V8509 = V2366, V8531 = V2394, V1070 = V2238, V7326 = V2122, V7325 = V2121, V7381 = V2119, V7552 = V1114, V7544 = V1399, V7551 = V1402, V7553 = V1403, V7255 = V2282,V7302 = V2102 ,V8512 = V2369, V8505 = V2362, V8514 = V2371, V8536 = V2395, V8504 = V2361, V8501 = V2358, V8508 = V2365, V8507 = V2364, V7501 = V3366, V7504 = V3369, V7505 = V3370,  V7507 = V3372, V7508 = V3373, V7208 = V3246, V7216 = V3254, V7217 = V3255, V7329 = V3123, V7221 = V3259, V7254 = V3283  
  )


# 2009 data
d81 <- read_dta("28402-0001-Data.dta")
d82 <- read_dta("28402-0002-Data.dta")
d83 <- read_dta("28402-0003-Data.dta")
d81 <- select(d81,V1101, V1114, V1400,V1403,V1404)
d82 <- select(d82,V1,V2361,V2360,V2369,V2371,V2367,V2395,V2239,V2123,V2122,V2120,V2283,V2102,V2370,V2363,V2372,V2396,V2362,V2359,V2366,V2365)
d83 <- select(d83,V3240, V3367, V3366,V3369,V3370,V3372,V3373,V3246,V3254,V3255,V3123,V3259,V3283)
d82[nrow(d82)+44,] <- NA # Add Na columns 
d82$V1101 <- d81$V1101
d82$V1114 <- d81$V1114
d82$V1400 <- d81$V1400
d82$V1403 <- d81$V1403
d82$V1404 <- d81$V1404
d83[nrow(d83)+2605,] <- NA # Add Na columns 
d82$V3240 <- d83$V3240
d82$V3367 <- d83$V3367
d82$V3366 <- d83$V3366
d82$V3369 <- d83$V3369
d82$V3370 <- d83$V3370
d82$V3372 <- d83$V3372
d82$V3373 <- d83$V3373
d82$V3246 <- d83$V3246
d82$V3254 <- d83$V3254
d82$V3255 <- d83$V3255
d82$V3123 <- d83$V3123
d82$V3259 <- d83$V3259
d82$V3283 <- d83$V3283
d82$V7589 <- NA
d82$V7590 <- NA
d82$V7562 <- NA
d82$V7563 <- NA
d2009 <- d82 %>% 
  rename(
    V501 = V1101, V7202 = V3240, V8503 = V2361, V8502 = V2360, V8511 = V2369, V8513 = V2371, V7502 = V3367, V8509 = V2367, V8531 = V2395, V1070 = V2239, V7326 = V2123, V7325 = V2122, V7381 = V2120, V7552 = V1114, V7544 = V1400, V7551 = V1403, V7553 = V1404, V7255 = V2283,V7302 = V2102 ,V8512 = V2370, V8505 = V2363, V8514 = V2372, V8536 = V2396, V8504 = V2362, V8501 = V2359, V8508 = V2366, V8507 = V2365, V7501 = V3366, V7504 = V3369, V7505 = V3370,  V7507 = V3372, V7508 = V3373, V7208 = V3246, V7216 = V3254, V7217 = V3255, V7329 = V3123, V7221 = V3259, V7254 = V3283  
  )



# 2010 data
d81 <- read_dta("30984-0001-Data.dta")
d82 <- read_dta("30984-0002-Data.dta")
d83 <- read_dta("30984-0003-Data.dta")

d81 <- select(d81,V1101, V1114, V1404,V1407,V1408,V1409,V1410)
d82 <- select(d82,V1,V2361,V2360,V2369,V2367, V2371,V2395,V2239,V2123,V2122,V2120,V2283,V2102,V2370,V2363,V2372,V2396,V2362,V2359,V2366,V2365)
d83 <- select(d83,V3240, V3367, V3366,V3369,V3370,V3372,V3373,V3246,V3254,V3255,V3123,V3259,V3283)
d82[nrow(d82)+35,] <- NA # Add Na columns 
d82$V501 <- d81$V1101
d82$V1114 <- d81$V1114
d82$V1399 <- d81$V1404
d82$V1402 <- d81$V1407
d82$V1403 <- d81$V1408
d83[nrow(d83)+2647,] <- NA # Add Na columns 
d82$V3240 <- d83$V3240
d82$V3367 <- d83$V3367
d82$V3366 <- d83$V3366
d82$V3369 <- d83$V3369
d82$V3370 <- d83$V3370
d82$V3372 <- d83$V3372
d82$V3373 <- d83$V3373
d82$V3246 <- d83$V3246
d82$V3254 <- d83$V3254
d82$V3255 <- d83$V3255
d82$V3123 <- d83$V3123
d82$V3259 <- d83$V3259
d82$V3283 <- d83$V3283
d82$V7589 <- NA
d82$V7590 <- NA
d82$V7562 <- d81$V1409
d82$V7563 <- d81$V1410

d2010 <- d82 %>% 
  rename(
    V7202 = V3240, V8503 = V2361, V8502 = V2360, V8511 = V2369, V8513 = V2371, V7502 = V3367, V8509 = V2367, V8531 = V2395, V1070 = V2239, V7326 = V2123, V7325 = V2122, V7381 = V2120, V7552 = V1114, V7544 = V1399, V7551 = V1402, V7553 = V1403, V7255 = V2283,V7302 = V2102 ,V8512 = V2370, V8505 = V2363, V8514 = V2372, V8536 = V2396, V8504 = V2362, V8501 = V2359, V8508 = V2366, V8507 = V2365, V7501 = V3366, V7504 = V3369, V7505 = V3370,  V7507 = V3372, V7508 = V3373, V7208 = V3246, V7216 = V3254, V7217 = V3255, V7329 = V3123, V7221 = V3259, V7254 = V3283
  )

#2011 data

d81 <- read_dta("33902-0001-Data.dta")
d82 <- read_dta("33902-0002-Data.dta")
d83 <- read_dta("33902-0003-Data.dta")

d81 <- select(d81,V1101, V1114, V1406,V1408,V1409,V1410,V1411)
d82 <- select(d82,V1,V2361,V2360, V2369,V2371, V2367, V2395, V2239, V2123,V2122,V2120, V2283, V2102, V2370,V2363, V2372, V2396, V2362, V2359, V2366, V2365)
d83 <- select(d83,V3240, V3367, V3366,V3369,V3370,V3372,V3373,V3246,V3254,V3255,V3123,V3259,V3283)

d81[nrow(d81)+19,] <- NA # Add NA columns 
d82$V501 <- d81$V1101
d82$V1114 <- d81$V1114
d82$V1399 <- d81$V1406
d82$V1402 <- d81$V1408
d82$V1403 <- d81$V1409
d83[nrow(d83)+2772,] <- NA # Add NA columns 
d82$V3240 <- d83$V3240
d82$V3240 <- d83$V3240
d82$V3367 <- d83$V3367
d82$V3366 <- d83$V3366
d82$V3369 <- d83$V3369
d82$V3370 <- d83$V3370
d82$V3372 <- d83$V3372
d82$V3373 <- d83$V3373
d82$V3246 <- d83$V3246
d82$V3254 <- d83$V3254
d82$V3255 <- d83$V3255
d82$V3123 <- d83$V3123
d82$V3259 <- d83$V3259
d82$V3283 <- d83$V3283
d82$V7589 <- NA
d82$V7590 <- NA
d82$V7562 <- d81$V1410
d82$V7563 <- d81$V1411

d2011 <- d82 %>% 
  rename(
    V7202 = V3240, V8503 = V2361, V8502 = V2360, V8511 = V2369, V8513 = V2371, V7502 = V3367, V8509 = V2367, V8531 = V2395, V1070 = V2239, V7326 = V2123, V7325 = V2122, V7381 = V2120, V7552 = V1114, V7544 = V1399, V7551 = V1402, V7553 = V1403, V7255 = V2283,V7302 = V2102 ,V8512 = V2370, V8505 = V2363, V8514 = V2372, V8536 = V2396, V8504 = V2362, V8501 = V2359, V8508 = V2366, V8507 = V2365, V7501 = V3366, V7504 = V3369, V7505 = V3370,  V7507 = V3372, V7508 = V3373, V7208 = V3246, V7216 = V3254, V7217 = V3255, V7329 = V3123, V7221 = V3259, V7254 = V3283  
  )


#2012-2018 data 
d2012 <- read_dta("34574-0001-Data.dta")
d2012<- select(d2012,V1, V501, V7202, V8503, V8502, V8511, V8513, V7502, V8509, V8531, V1070, V7326, V7325, V7381, V7552, V7544, V7551, V7553, V7562, V7563,V7255,V7302,V8512,V8502,V8505,V8509,V8514,V8536,V8504,V8501,V8508,V8503,V8507,V8511,V8513,V7501,V7502,V7504,V7505,V7507,V7508,V7208,V7216,V7217,V7329,V7221,V7254)
d2012$V7589<- NA 
d2012$V7590<- NA
d2013 <- read_dta("35166-0001-Data.dta")
d2013<- select(d2013,V1, V501, V7202, V8503, V8502, V8511, V8513, V7502, V8509, V8531, V1070, V7326, V7325, V7381, V7552, V7544, V7551, V7553, V7589, V7590, V7562, V7563,V7255,V7302,V8512,V8502,V8505,V8509,V8514,V8536,V8504,V8501,V8508,V8503,V8507,V8511,V8513,V7501,V7502,V7504,V7505,V7507,V7508,V7208,V7216,V7217,V7329,V7221,V7254)
d2014 <- read_dta("36149-0001-Data.dta")
d2014<- select(d2014,V1, V501, V7202, V8503, V8502, V8511, V8513, V7502, V8509, V8531, V1070, V7326, V7325, V7381, V7552, V7544, V7551, V7553, V7589, V7590, V7562, V7563,V7255,V7302,V8512,V8505,V8514,V8536,V8504,V8501,V8508,V8507,V7501,V7504,V7505,V7507,V7508,V7208,V7216,V7217,V7329,V7221,V7254)
d2015 <- read_dta("36407-0001-Data.dta")
d2015<- select(d2015,V1, V501, V7202, V8503, V8502, V8511, V8513, V7502, V8509, V8531, V1070, V7326, V7325, V7381, V7552, V7544, V7551, V7553, V7589, V7590, V7562, V7563,V7255,V7302,V8512,V8502,V8505,V8509,V8514,V8536,V8504,V8501,V8508,V8503,V8507,V8511,V8513,V7501,V7502,V7504,V7505,V7507,V7508,V7208,V7216,V7217,V7329,V7221,V7254)
d2016 <- read_dta("36799-0001-Data.dta")
d2016<- select(d2016,V1, V501, V7202, V8503, V8502, V8511, V8513, V7502, V8509, V8531, V1070, V7326, V7325, V7381, V7552, V7544, V7551, V7553, V7589, V7590, V7562, V7563,V7255,V7302,V8512,V8502,V8505,V8509,V8514,V8536,V8504,V8501,V8508,V8503,V8507,V8511,V8513,V7501,V7502,V7504,V7505,V7507,V7508,V7208,V7216,V7217,V7329,V7221,V7254)
d2017 <- read_dta("37183-0001-Data.dta")
d2017<- select(d2017,V1,V501, V7202, V8503, V8502, V8511, V8513, V7502, V8509, V8531, V1070, V7326, V7325, V7381, V7552, V7544, V7551, V7553, V7589, V7590, V7562, V7563,V7255,V7302,V8512,V8502,V8505,V8509,V8514,V8536,V8504,V8501,V8508,V8503,V8507,V8511,V8513,V7501,V7502,V7504,V7505,V7507,V7508,V7208,V7216,V7217,V7329,V7221,V7254)

d2018 <- read_dta("37415-0001-Data.dta")
d2018 <- d2018 %>% 
      rename(
        V7590 = V7686, V7325 = V7689, V7326= V7690, V7381 = V7678, V7552 = V7685, V7553=V7682, V7589=V7685, V7590 = V7686, V7563 =V7684, V7562 = V7683)
      
d2018<- select(d2018,V1, V501, V7202, V8503, V8502, V8511, V8513, V7502, V8509, V8531, V1070,V7255,V7302,V8512,V8502,V8505,V8509,V8514,V8536,V8504,V8501,V8508,V8503,V8507,V8511,V8513,V7501,V7502,V7504,V7505,V7507,V7508,V7208,V7216,V7217,V7329,V7221,V7254)
d2018$V7326<-NA
d2018$V7325<-NA
d2018$V7381<-NA
d2018$V7552<-NA
d2018$V7544<-NA
d2018$V7551<-NA
d2018$V7553<-NA
d2018$V7589<-NA
d2018$V7590<-NA
d2018$V7562<-NA
d2018$V7563<-NA

#Re order names to unify variables
d2008<-d2008[ , order(names(d2008))]
d2009<-d2009[ , order(names(d2009))]
d2010<-d2010[ , order(names(d2010))]
d2011<-d2011[ , order(names(d2011))]
merged_mtf <- rbind(d2008,d2009,d2010,d2011, d2012, d2013,d2014,d2015,d2016,d2017,d2018)

#output file 
write.csv(merged_mtf, file = "merged_mtf.csv")

